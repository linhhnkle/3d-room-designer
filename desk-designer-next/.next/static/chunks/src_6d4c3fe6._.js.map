{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Linh/Desktop/DeskDesigner/desk-designer-next/src/components/Scene/Room.tsx"],"sourcesContent":["import { useMemo, useRef } from 'react'\nimport { Mesh, PlaneGeometry, MeshLambertMaterial, DoubleSide } from 'three'\nimport { useStore } from '@/stores/useStore'\n\n// Geometries will be created inside the component\n\n// Shared materials to reduce memory usage\nconst createFloorMaterial = () => new MeshLambertMaterial({ \n  color: 0xd4b896,\n  side: DoubleSide \n})\n\nconst createWallMaterial = () => new MeshLambertMaterial({ \n  color: 0xe8dcc6,\n  side: DoubleSide \n})\n\nexport function Room() {\n  const floorRef = useRef<Mesh>(null)\n  const backWallRef = useRef<Mesh>(null)\n  const leftWallRef = useRef<Mesh>(null)\n  \n  const surfaces = useStore(state => state.surfaces)\n  const requestRender = useStore(state => state.requestRender)\n  \n  // Memoized geometries and materials\n  const floorGeometry = useMemo(() => new PlaneGeometry(20, 20), [])\n  const wallGeometry = useMemo(() => new PlaneGeometry(20, 8), [])\n  const floorMaterial = useMemo(() => createFloorMaterial(), [])\n  const wallMaterial = useMemo(() => createWallMaterial(), [])\n  \n  // Register surfaces when components mount\n  const registerSurface = (mesh: Mesh | null) => {\n    if (mesh && !surfaces.includes(mesh)) {\n      surfaces.push(mesh)\n      requestRender()\n    }\n  }\n  \n  return (\n    <group name=\"room\">\n      {/* Floor */}\n      <mesh \n        ref={(mesh) => {\n          floorRef.current = mesh\n          registerSurface(mesh)\n        }}\n        geometry={floorGeometry}\n        material={floorMaterial}\n        rotation={[-Math.PI / 2, 0, 0]}\n        position={[0, 0, 0]}\n        receiveShadow\n        userData={{ isFloor: true, isSurface: true }}\n        name=\"floor\"\n      />\n      \n      {/* Back Wall */}\n      <mesh \n        ref={(mesh) => {\n          backWallRef.current = mesh\n          registerSurface(mesh)\n        }}\n        geometry={wallGeometry}\n        material={wallMaterial}\n        position={[0, 4, -10]}\n        receiveShadow\n        userData={{ isWall: true }}\n        name=\"backWall\"\n      />\n      \n      {/* Left Wall */}\n      <mesh \n        ref={(mesh) => {\n          leftWallRef.current = mesh\n          registerSurface(mesh)\n        }}\n        geometry={wallGeometry}\n        material={wallMaterial}\n        position={[-10, 4, 0]}\n        rotation={[0, Math.PI / 2, 0]}\n        receiveShadow\n        userData={{ isWall: true }}\n        name=\"leftWall\"\n      />\n    </group>\n  )\n}\n\n// Separate component for room color changes to prevent unnecessary re-renders\nexport function useRoomColors() {\n  const updateFloorColor = (color: string) => {\n    // Implementation will be added when color system is integrated\n  }\n  \n  const updateWallColor = (color: string) => {\n    // Implementation will be added when color system is integrated\n  }\n  \n  return { updateFloorColor, updateWallColor }\n}"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;;;;;;AAEA,kDAAkD;AAElD,0CAA0C;AAC1C,MAAM,sBAAsB,IAAM,IAAI,yKAAmB,CAAC;QACxD,OAAO;QACP,MAAM,gKAAU;IAClB;AAEA,MAAM,qBAAqB,IAAM,IAAI,yKAAmB,CAAC;QACvD,OAAO;QACP,MAAM,gKAAU;IAClB;AAEO,SAAS;;IACd,MAAM,WAAW,IAAA,uKAAM,EAAO;IAC9B,MAAM,cAAc,IAAA,uKAAM,EAAO;IACjC,MAAM,cAAc,IAAA,uKAAM,EAAO;IAEjC,MAAM,WAAW,IAAA,wIAAQ;mCAAC,CAAA,QAAS,MAAM,QAAQ;;IACjD,MAAM,gBAAgB,IAAA,wIAAQ;wCAAC,CAAA,QAAS,MAAM,aAAa;;IAE3D,oCAAoC;IACpC,MAAM,gBAAgB,IAAA,wKAAO;uCAAC,IAAM,IAAI,mKAAa,CAAC,IAAI;sCAAK,EAAE;IACjE,MAAM,eAAe,IAAA,wKAAO;sCAAC,IAAM,IAAI,mKAAa,CAAC,IAAI;qCAAI,EAAE;IAC/D,MAAM,gBAAgB,IAAA,wKAAO;uCAAC,IAAM;sCAAuB,EAAE;IAC7D,MAAM,eAAe,IAAA,wKAAO;sCAAC,IAAM;qCAAsB,EAAE;IAE3D,0CAA0C;IAC1C,MAAM,kBAAkB,CAAC;QACvB,IAAI,QAAQ,CAAC,SAAS,QAAQ,CAAC,OAAO;YACpC,SAAS,IAAI,CAAC;YACd;QACF;IACF;IAEA,qBACE,6LAAC;QAAM,MAAK;;0BAEV,6LAAC;gBACC,KAAK,CAAC;oBACJ,SAAS,OAAO,GAAG;oBACnB,gBAAgB;gBAClB;gBACA,UAAU;gBACV,UAAU;gBACV,UAAU;oBAAC,CAAC,KAAK,EAAE,GAAG;oBAAG;oBAAG;iBAAE;gBAC9B,UAAU;oBAAC;oBAAG;oBAAG;iBAAE;gBACnB,aAAa;gBACb,UAAU;oBAAE,SAAS;oBAAM,WAAW;gBAAK;gBAC3C,MAAK;;;;;;0BAIP,6LAAC;gBACC,KAAK,CAAC;oBACJ,YAAY,OAAO,GAAG;oBACtB,gBAAgB;gBAClB;gBACA,UAAU;gBACV,UAAU;gBACV,UAAU;oBAAC;oBAAG;oBAAG,CAAC;iBAAG;gBACrB,aAAa;gBACb,UAAU;oBAAE,QAAQ;gBAAK;gBACzB,MAAK;;;;;;0BAIP,6LAAC;gBACC,KAAK,CAAC;oBACJ,YAAY,OAAO,GAAG;oBACtB,gBAAgB;gBAClB;gBACA,UAAU;gBACV,UAAU;gBACV,UAAU;oBAAC,CAAC;oBAAI;oBAAG;iBAAE;gBACrB,UAAU;oBAAC;oBAAG,KAAK,EAAE,GAAG;oBAAG;iBAAE;gBAC7B,aAAa;gBACb,UAAU;oBAAE,QAAQ;gBAAK;gBACzB,MAAK;;;;;;;;;;;;AAIb;GArEgB;;QAKG,wIAAQ;QACH,wIAAQ;;;KANhB;AAwET,SAAS;IACd,MAAM,mBAAmB,CAAC;IACxB,+DAA+D;IACjE;IAEA,MAAM,kBAAkB,CAAC;IACvB,+DAA+D;IACjE;IAEA,OAAO;QAAE;QAAkB;IAAgB;AAC7C","debugId":null}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Linh/Desktop/DeskDesigner/desk-designer-next/src/components/Scene/Lights.tsx"],"sourcesContent":["import { useRef, useMemo } from 'react'\nimport { DirectionalLight, AmbientLight } from 'three'\nimport { useHelper } from '@react-three/drei'\nimport { DirectionalLightHelper } from 'three'\n\ninterface LightsProps {\n  timeOfDay?: 'day' | 'sunset' | 'night'\n  showHelpers?: boolean\n}\n\nexport function Lights({ timeOfDay = 'day', showHelpers = false }: LightsProps) {\n  const sunLightRef = useRef<DirectionalLight>(null)\n  const ambientLightRef = useRef<AmbientLight>(null)\n  \n  // Show light helpers in development\n  useHelper(showHelpers && sunLightRef, DirectionalLightHelper, 1)\n  \n  // Memoized light configurations for different times of day\n  const lightConfig = useMemo(() => {\n    switch (timeOfDay) {\n      case 'sunset':\n        return {\n          ambient: { color: 0xfff0d4, intensity: 0.3 },\n          sun: { \n            color: 0xffb366, \n            intensity: 0.8,\n            position: [5, 8, 10] as [number, number, number]\n          }\n        }\n      case 'night':\n        return {\n          ambient: { color: 0x404080, intensity: 0.4 },\n          sun: { \n            color: 0x8080ff, \n            intensity: 0.3,\n            position: [-5, 6, 8] as [number, number, number]\n          }\n        }\n      default: // day\n        return {\n          ambient: { color: 0xfff4e6, intensity: 0.25 },\n          sun: { \n            color: 0xffd4a0, \n            intensity: 0.6,\n            position: [10, 15, 8] as [number, number, number]\n          }\n        }\n    }\n  }, [timeOfDay])\n  \n  return (\n    <group name=\"lights\">\n      {/* Ambient Light */}\n      <ambientLight\n        ref={ambientLightRef}\n        color={lightConfig.ambient.color}\n        intensity={lightConfig.ambient.intensity}\n      />\n      \n      {/* Directional Light (Sun) */}\n      <directionalLight\n        ref={sunLightRef}\n        color={lightConfig.sun.color}\n        intensity={lightConfig.sun.intensity}\n        position={lightConfig.sun.position}\n        castShadow\n        shadow-mapSize-width={1024}\n        shadow-mapSize-height={1024}\n        shadow-camera-near={0.1}\n        shadow-camera-far={50}\n        shadow-camera-left={-15}\n        shadow-camera-right={15}\n        shadow-camera-top={15}\n        shadow-camera-bottom={-15}\n        shadow-radius={10}\n        shadow-blurSamples={8}\n      />\n    </group>\n  )\n}\n\n// Performance-optimized shadow settings\nexport const SHADOW_CONFIG = {\n  enabled: true,\n  type: 'PCFSoftShadowMap' as const,\n  autoUpdate: false, // Manual shadow updates for better performance\n}"],"names":[],"mappings":";;;;;;;AAAA;AAEA;AACA;;;;;;AAOO,SAAS,OAAO,KAAuD;QAAvD,EAAE,YAAY,KAAK,EAAE,cAAc,KAAK,EAAe,GAAvD;;IACrB,MAAM,cAAc,IAAA,uKAAM,EAAmB;IAC7C,MAAM,kBAAkB,IAAA,uKAAM,EAAe;IAE7C,oCAAoC;IACpC,IAAA,0KAAS,EAAC,eAAe,aAAa,4KAAsB,EAAE;IAE9D,2DAA2D;IAC3D,MAAM,cAAc,IAAA,wKAAO;uCAAC;YAC1B,OAAQ;gBACN,KAAK;oBACH,OAAO;wBACL,SAAS;4BAAE,OAAO;4BAAU,WAAW;wBAAI;wBAC3C,KAAK;4BACH,OAAO;4BACP,WAAW;4BACX,UAAU;gCAAC;gCAAG;gCAAG;6BAAG;wBACtB;oBACF;gBACF,KAAK;oBACH,OAAO;wBACL,SAAS;4BAAE,OAAO;4BAAU,WAAW;wBAAI;wBAC3C,KAAK;4BACH,OAAO;4BACP,WAAW;4BACX,UAAU;gCAAC,CAAC;gCAAG;gCAAG;6BAAE;wBACtB;oBACF;gBACF;oBACE,OAAO;wBACL,SAAS;4BAAE,OAAO;4BAAU,WAAW;wBAAK;wBAC5C,KAAK;4BACH,OAAO;4BACP,WAAW;4BACX,UAAU;gCAAC;gCAAI;gCAAI;6BAAE;wBACvB;oBACF;YACJ;QACF;sCAAG;QAAC;KAAU;IAEd,qBACE,6LAAC;QAAM,MAAK;;0BAEV,6LAAC;gBACC,KAAK;gBACL,OAAO,YAAY,OAAO,CAAC,KAAK;gBAChC,WAAW,YAAY,OAAO,CAAC,SAAS;;;;;;0BAI1C,6LAAC;gBACC,KAAK;gBACL,OAAO,YAAY,GAAG,CAAC,KAAK;gBAC5B,WAAW,YAAY,GAAG,CAAC,SAAS;gBACpC,UAAU,YAAY,GAAG,CAAC,QAAQ;gBAClC,UAAU;gBACV,wBAAsB;gBACtB,yBAAuB;gBACvB,sBAAoB;gBACpB,qBAAmB;gBACnB,sBAAoB,CAAC;gBACrB,uBAAqB;gBACrB,qBAAmB;gBACnB,wBAAsB,CAAC;gBACvB,iBAAe;gBACf,sBAAoB;;;;;;;;;;;;AAI5B;GArEgB;;QAKd,0KAAS;;;KALK;AAwET,MAAM,gBAAgB;IAC3B,SAAS;IACT,MAAM;IACN,YAAY;AACd","debugId":null}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Linh/Desktop/DeskDesigner/desk-designer-next/src/components/Objects/ObjectLoader.tsx"],"sourcesContent":["import { Suspense, useMemo, useCallback, useRef } from 'react'\nimport { useGLTF } from '@react-three/drei'\nimport * as THREE from 'three'\nimport { Object3D, Vector3, Box3, Mesh, MeshLambertMaterial } from 'three'\nimport { useStore } from '@/stores/useStore'\nimport { GLTF } from 'three/examples/jsm/loaders/GLTFLoader'\n\n// Model path mapping\nconst MODEL_PATHS: Record<string, string> = {\n  desk: '/Furniture/desk1.glb',\n  chair: '/Furniture/chair.glb',\n  monitor: '/Furniture/monitor.glb',\n  plant: '/Furniture/plant1.glb'\n}\n\n// Fallback geometries for failed models\nconst FALLBACK_GEOMETRIES = {\n  desk: { type: 'box', args: [4, 1.2, 2], color: 0x8B4513 },\n  chair: { type: 'box', args: [1.2, 2, 1.2], color: 0x654321 },\n  monitor: { type: 'box', args: [2, 1.5, 0.2], color: 0x2a2a2a },\n  plant: { type: 'sphere', args: [0.8, 8, 6], color: 0x4a7c59 }\n}\n\n// Scale configurations\nconst OBJECT_SCALES: Record<string, number> = {\n  desk: 4,\n  chair: 4,\n  monitor: 3,\n  plant: 3,\n  sofa: 5,\n  lamp: 2,\n  laptop: 1.5\n}\n\ninterface GLTFModelProps {\n  type: string\n  position: Vector3\n  onLoad?: (object: Object3D) => void\n}\n\n// Individual GLTF model component with error boundary\nfunction GLTFModel({ type, position, onLoad }: GLTFModelProps) {\n  const modelRef = useRef<Object3D>(null)\n  const modelPath = MODEL_PATHS[type]\n  \n  try {\n    const { scene } = useGLTF(modelPath) as GLTF\n    \n    // Clone the scene to allow multiple instances\n    const clonedScene = useMemo(() => {\n      const clone = scene.clone()\n      \n      // Set scale\n      const scale = OBJECT_SCALES[type] || 1\n      clone.scale.setScalar(scale)\n      \n      // Set position\n      clone.position.copy(position)\n      \n      // Configure for shadows\n      clone.traverse((child) => {\n        if (child instanceof Mesh) {\n          child.castShadow = true\n          child.receiveShadow = true\n          \n          // Clone materials to avoid sharing\n          if (child.material) {\n            child.material = child.material.clone()\n          }\n        }\n      })\n      \n      // Set metadata\n      clone.userData = {\n        type,\n        isModel: true,\n        isSurface: ['desk', 'chair', 'sofa'].includes(type)\n      }\n      \n      return clone\n    }, [scene, type, position])\n    \n    // Notify parent when loaded\n    useMemo(() => {\n      if (onLoad && clonedScene) {\n        onLoad(clonedScene)\n      }\n    }, [clonedScene, onLoad])\n    \n    return <primitive ref={modelRef} object={clonedScene} />\n    \n  } catch (error) {\n    console.warn(`Failed to load model ${type}, using fallback`)\n    return <FallbackModel type={type} position={position} onLoad={onLoad} />\n  }\n}\n\n// Fallback component for failed model loads\nfunction FallbackModel({ type, position, onLoad }: GLTFModelProps) {\n  const meshRef = useRef<Mesh>(null)\n  const fallback = FALLBACK_GEOMETRIES[type] || FALLBACK_GEOMETRIES.desk\n  \n  const mesh = useMemo(() => {\n    let geometry\n    \n    switch (fallback.type) {\n      case 'sphere':\n        geometry = new THREE.SphereGeometry(...fallback.args)\n        break\n      default:\n        geometry = new THREE.BoxGeometry(...fallback.args)\n    }\n    \n    const material = new MeshLambertMaterial({ color: fallback.color })\n    const mesh = new Mesh(geometry, material)\n    \n    mesh.position.copy(position)\n    mesh.castShadow = true\n    mesh.receiveShadow = true\n    \n    mesh.userData = {\n      type,\n      isModel: false,\n      isSurface: ['desk', 'chair', 'sofa'].includes(type)\n    }\n    \n    return mesh\n  }, [type, position, fallback])\n  \n  useMemo(() => {\n    if (onLoad && mesh) {\n      onLoad(mesh)\n    }\n  }, [mesh, onLoad])\n  \n  return <primitive ref={meshRef} object={mesh} />\n}\n\n// Loading placeholder component\nfunction LoadingPlaceholder({ position }: { position: Vector3 }) {\n  return (\n    <mesh position={position}>\n      <boxGeometry args={[1, 1, 1]} />\n      <meshBasicMaterial color={0x888888} transparent opacity={0.3} />\n    </mesh>\n  )\n}\n\n// Main object loader with suspense and error handling\ninterface ObjectLoaderProps {\n  type: string\n  position?: Vector3\n  id?: string\n}\n\nexport function ObjectLoader({ type, position = new Vector3(), id }: ObjectLoaderProps) {\n  const addObject = useStore(state => state.addObject)\n  const selectObject = useStore(state => state.selectObject)\n  const surfaces = useStore(state => state.surfaces)\n  \n  const handleObjectLoad = useCallback((object: Object3D) => {\n    const objectData = {\n      id: id || `${type}-${Date.now()}`,\n      object,\n      type,\n      position: position.clone(),\n      scale: new Vector3(1, 1, 1),\n      rotation: 0\n    }\n    \n    // Add to store\n    addObject(objectData)\n    \n    // Add to surfaces if applicable\n    if (object.userData.isSurface) {\n      surfaces.push(object)\n    }\n    \n    // Auto-select newly added objects\n    selectObject(objectData)\n  }, [type, position, id, addObject, selectObject, surfaces])\n  \n  return (\n    <Suspense fallback={<LoadingPlaceholder position={position} />}>\n      <GLTFModel \n        type={type} \n        position={position} \n        onLoad={handleObjectLoad}\n      />\n    </Suspense>\n  )\n}\n\n// Preload all models for better performance\nexport function preloadModels() {\n  Object.values(MODEL_PATHS).forEach(path => {\n    useGLTF.preload(path)\n  })\n}\n\n// Cleanup function to dispose of unused models\nuseGLTF.clear = () => {\n  Object.values(MODEL_PATHS).forEach(path => {\n    useGLTF.clear(path)\n  })\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 656, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Linh/Desktop/DeskDesigner/desk-designer-next/src/hooks/usePerformance.ts"],"sourcesContent":["import { useFrame } from '@react-three/fiber'\nimport { useCallback, useRef, useState } from 'react'\nimport { useStore } from '@/stores/useStore'\n\n// Performance monitoring hook\nexport function usePerformanceMonitor() {\n  const [fps, setFps] = useState(60)\n  const frameCount = useRef(0)\n  const lastTime = useRef(Date.now())\n  const setFrameRate = useStore(state => state.setFrameRate)\n  \n  useFrame(() => {\n    frameCount.current++\n    const now = Date.now()\n    \n    if (now - lastTime.current >= 1000) {\n      const currentFps = Math.round((frameCount.current * 1000) / (now - lastTime.current))\n      setFps(currentFps)\n      setFrameRate(currentFps)\n      frameCount.current = 0\n      lastTime.current = now\n    }\n  })\n  \n  return fps\n}\n\n// Render-on-demand hook\nexport function useRenderOnDemand() {\n  const renderRequested = useStore(state => state.renderRequested)\n  const requestRender = useStore(state => state.requestRender)\n  const invalidate = useCallback(() => requestRender(), [requestRender])\n  \n  return { renderRequested, invalidate }\n}\n\n// Debounced interaction hook\nexport function useDebouncedCallback<T extends (...args: any[]) => void>(\n  callback: T,\n  delay: number\n): T {\n  const timeoutRef = useRef<NodeJS.Timeout>()\n  \n  return useCallback((...args: Parameters<T>) => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current)\n    }\n    \n    timeoutRef.current = setTimeout(() => {\n      callback(...args)\n    }, delay)\n  }, [callback, delay]) as T\n}\n\n// LOD (Level of Detail) hook\nexport function useLOD(distance: number) {\n  const [lodLevel, setLodLevel] = useState<'high' | 'medium' | 'low'>('high')\n  \n  useFrame(({ camera }) => {\n    const distanceFromCamera = camera.position.distanceTo(camera.position)\n    \n    if (distance > 20) {\n      setLodLevel('low')\n    } else if (distance > 10) {\n      setLodLevel('medium')\n    } else {\n      setLodLevel('high')\n    }\n  })\n  \n  return lodLevel\n}\n\n// Memory usage tracking\nexport function useMemoryMonitor() {\n  const [memoryUsage, setMemoryUsage] = useState<{\n    usedJSHeapSize: number\n    totalJSHeapSize: number\n    jsHeapSizeLimit: number\n  } | null>(null)\n  \n  useFrame(() => {\n    if ('memory' in performance) {\n      const memory = (performance as any).memory\n      setMemoryUsage({\n        usedJSHeapSize: Math.round(memory.usedJSHeapSize / 1048576), // MB\n        totalJSHeapSize: Math.round(memory.totalJSHeapSize / 1048576), // MB\n        jsHeapSizeLimit: Math.round(memory.jsHeapSizeLimit / 1048576) // MB\n      })\n    }\n  }, 60) // Update every 60 frames (1 second at 60fps)\n  \n  return memoryUsage\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;;;;;AAGO,SAAS;;IACd,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAC;IAC/B,MAAM,aAAa,IAAA,uKAAM,EAAC;IAC1B,MAAM,WAAW,IAAA,uKAAM,EAAC,KAAK,GAAG;IAChC,MAAM,eAAe,IAAA,wIAAQ;wDAAC,CAAA,QAAS,MAAM,YAAY;;IAEzD,IAAA,8NAAQ;0CAAC;YACP,WAAW,OAAO;YAClB,MAAM,MAAM,KAAK,GAAG;YAEpB,IAAI,MAAM,SAAS,OAAO,IAAI,MAAM;gBAClC,MAAM,aAAa,KAAK,KAAK,CAAC,AAAC,WAAW,OAAO,GAAG,OAAQ,CAAC,MAAM,SAAS,OAAO;gBACnF,OAAO;gBACP,aAAa;gBACb,WAAW,OAAO,GAAG;gBACrB,SAAS,OAAO,GAAG;YACrB;QACF;;IAEA,OAAO;AACT;GApBgB;;QAIO,wIAAQ;QAE7B,8NAAQ;;;AAiBH,SAAS;;IACd,MAAM,kBAAkB,IAAA,wIAAQ;uDAAC,CAAA,QAAS,MAAM,eAAe;;IAC/D,MAAM,gBAAgB,IAAA,wIAAQ;qDAAC,CAAA,QAAS,MAAM,aAAa;;IAC3D,MAAM,aAAa,IAAA,4KAAW;qDAAC,IAAM;oDAAiB;QAAC;KAAc;IAErE,OAAO;QAAE;QAAiB;IAAW;AACvC;IANgB;;QACU,wIAAQ;QACV,wIAAQ;;;AAOzB,SAAS,qBACd,QAAW,EACX,KAAa;;IAEb,MAAM,aAAa,IAAA,uKAAM;IAEzB,OAAO,IAAA,4KAAW;4CAAC;6CAAI;gBAAA;;YACrB,IAAI,WAAW,OAAO,EAAE;gBACtB,aAAa,WAAW,OAAO;YACjC;YAEA,WAAW,OAAO,GAAG;oDAAW;oBAC9B,YAAY;gBACd;mDAAG;QACL;2CAAG;QAAC;QAAU;KAAM;AACtB;IAfgB;AAkBT,SAAS,OAAO,QAAgB;;IACrC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAA4B;IAEpE,IAAA,8NAAQ;2BAAC;gBAAC,EAAE,MAAM,EAAE;YAClB,MAAM,qBAAqB,OAAO,QAAQ,CAAC,UAAU,CAAC,OAAO,QAAQ;YAErE,IAAI,WAAW,IAAI;gBACjB,YAAY;YACd,OAAO,IAAI,WAAW,IAAI;gBACxB,YAAY;YACd,OAAO;gBACL,YAAY;YACd;QACF;;IAEA,OAAO;AACT;IAhBgB;;QAGd,8NAAQ;;;AAgBH,SAAS;;IACd,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAIpC;IAEV,IAAA,8NAAQ;qCAAC;YACP,IAAI,YAAY,aAAa;gBAC3B,MAAM,SAAS,AAAC,YAAoB,MAAM;gBAC1C,eAAe;oBACb,gBAAgB,KAAK,KAAK,CAAC,OAAO,cAAc,GAAG;oBACnD,iBAAiB,KAAK,KAAK,CAAC,OAAO,eAAe,GAAG;oBACrD,iBAAiB,KAAK,KAAK,CAAC,OAAO,eAAe,GAAG,SAAS,KAAK;gBACrE;YACF;QACF;oCAAG,KAAI,6CAA6C;IAEpD,OAAO;AACT;IAnBgB;;QAOd,8NAAQ","debugId":null}},
    {"offset": {"line": 803, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Linh/Desktop/DeskDesigner/desk-designer-next/src/hooks/useObjectSelection.ts"],"sourcesContent":["import { useThree } from '@react-three/fiber'\nimport { useCallback, useMemo, useRef } from 'react'\nimport { Object3D, Raycaster, Vector2, Vector3, Mesh, Box3 } from 'three'\nimport { useStore } from '@/stores/useStore'\nimport { useDebouncedCallback } from './usePerformance'\n\nexport function useObjectSelection() {\n  const { camera, scene, gl } = useThree()\n  const raycaster = useMemo(() => new Raycaster(), [])\n  const mouse = useMemo(() => new Vector2(), [])\n  const dragOffset = useRef<Vector3>(new Vector3())\n  const isDragging = useRef(false)\n  \n  const selectedObject = useStore(state => state.selectedObject)\n  const selectObject = useStore(state => state.selectObject)\n  const objects = useStore(state => state.objects)\n  const surfaces = useStore(state => state.surfaces)\n  const requestRender = useStore(state => state.requestRender)\n  \n  // Spatial indexing for faster selection\n  const spatialIndex = useMemo(() => {\n    const index = new Map<string, { object: Object3D; bounds: Box3 }>()\n    objects.forEach(obj => {\n      const bounds = new Box3().setFromObject(obj.object)\n      index.set(obj.id, { object: obj.object, bounds })\n    })\n    return index\n  }, [objects])\n  \n  // Optimized raycast with spatial culling\n  const raycastObjects = useCallback((point: Vector2): Object3D | null => {\n    mouse.copy(point)\n    raycaster.setFromCamera(mouse, camera)\n    \n    // Pre-filter objects using spatial bounds\n    const candidates: Object3D[] = []\n    spatialIndex.forEach(({ object, bounds }) => {\n      if (raycaster.ray.intersectsBox(bounds)) {\n        candidates.push(object)\n      }\n    })\n    \n    if (candidates.length === 0) return null\n    \n    const intersects = raycaster.intersectObjects(candidates, true)\n    return intersects.length > 0 ? intersects[0].object : null\n  }, [camera, raycaster, mouse, spatialIndex])\n  \n  // Debounced hover detection\n  const handleHover = useDebouncedCallback((event: PointerEvent) => {\n    const rect = gl.domElement.getBoundingClientRect()\n    const point = new Vector2(\n      ((event.clientX - rect.left) / rect.width) * 2 - 1,\n      -((event.clientY - rect.top) / rect.height) * 2 + 1\n    )\n    \n    const hitObject = raycastObjects(point)\n    // Update hover state if needed\n    requestRender()\n  }, 16) // ~60fps\n  \n  // Optimized selection\n  const handleSelect = useCallback((event: PointerEvent) => {\n    if (isDragging.current) return\n    \n    const rect = gl.domElement.getBoundingClientRect()\n    const point = new Vector2(\n      ((event.clientX - rect.left) / rect.width) * 2 - 1,\n      -((event.clientY - rect.top) / rect.height) * 2 + 1\n    )\n    \n    const hitObject = raycastObjects(point)\n    \n    if (hitObject) {\n      // Find the object data from our store\n      const objectData = objects.find(obj => \n        obj.object === hitObject || obj.object.getObjectById(hitObject.id)\n      )\n      \n      if (objectData) {\n        selectObject(objectData)\n        \n        // Calculate drag offset for smooth dragging\n        mouse.copy(point)\n        raycaster.setFromCamera(mouse, camera)\n        const intersects = raycaster.intersectObject(hitObject, true)\n        \n        if (intersects.length > 0) {\n          dragOffset.current.copy(objectData.position).sub(intersects[0].point)\n        }\n      }\n    } else {\n      selectObject(null)\n    }\n    \n    requestRender()\n  }, [raycastObjects, objects, selectObject, camera, raycaster, mouse, requestRender])\n  \n  // Surface detection for smart placement\n  const findSurface = useCallback((position: Vector3): { surface: Object3D; y: number } | null => {\n    const downRay = new Raycaster(\n      new Vector3(position.x, position.y + 1, position.z),\n      new Vector3(0, -1, 0)\n    )\n    \n    const surfaceIntersects = downRay.intersectObjects(surfaces, true)\n    \n    for (const intersect of surfaceIntersects) {\n      if (intersect.object !== selectedObject?.object) {\n        return {\n          surface: intersect.object,\n          y: intersect.point.y\n        }\n      }\n    }\n    \n    return { surface: surfaces[0], y: 0 } // Default to floor\n  }, [surfaces, selectedObject])\n  \n  return {\n    handleSelect,\n    handleHover,\n    findSurface,\n    selectedObject,\n    isDragging: isDragging.current\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 983, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Linh/Desktop/DeskDesigner/desk-designer-next/src/hooks/useDragAndDrop.ts"],"sourcesContent":["import { useThree } from '@react-three/fiber'\nimport { useCallback, useRef } from 'react'\nimport { Vector2, Vector3, Plane, Raycaster } from 'three'\nimport { useStore } from '@/stores/useStore'\nimport { useDebouncedCallback } from './usePerformance'\n\nexport function useDragAndDrop() {\n  const { camera, gl } = useThree()\n  const isDragging = useRef(false)\n  const dragPlane = useRef(new Plane(new Vector3(0, 1, 0), 0))\n  const dragOffset = useRef(new Vector3())\n  const raycaster = useRef(new Raycaster())\n  const mouse = useRef(new Vector2())\n  const startPosition = useRef(new Vector3())\n  \n  const selectedObject = useStore(state => state.selectedObject)\n  const updateObject = useStore(state => state.updateObject)\n  const surfaces = useStore(state => state.surfaces)\n  const requestRender = useStore(state => state.requestRender)\n  \n  // Start dragging\n  const startDrag = useCallback((event: PointerEvent) => {\n    if (!selectedObject) return\n    \n    isDragging.current = true\n    startPosition.current.copy(selectedObject.position)\n    \n    const rect = gl.domElement.getBoundingClientRect()\n    mouse.current.set(\n      ((event.clientX - rect.left) / rect.width) * 2 - 1,\n      -((event.clientY - rect.top) / rect.height) * 2 + 1\n    )\n    \n    raycaster.current.setFromCamera(mouse.current, camera)\n    \n    // Set drag plane at object's current Y position\n    dragPlane.current.setFromNormalAndCoplanarPoint(\n      new Vector3(0, 1, 0),\n      selectedObject.position\n    )\n    \n    // Calculate intersection point and offset\n    const intersectPoint = new Vector3()\n    raycaster.current.ray.intersectPlane(dragPlane.current, intersectPoint)\n    \n    if (intersectPoint) {\n      dragOffset.current.copy(selectedObject.position).sub(intersectPoint)\n    }\n    \n    gl.domElement.style.cursor = 'grabbing'\n    requestRender()\n  }, [selectedObject, camera, gl, requestRender])\n  \n  // Optimized drag movement with surface snapping\n  const handleDrag = useDebouncedCallback((event: PointerEvent) => {\n    if (!isDragging.current || !selectedObject) return\n    \n    const rect = gl.domElement.getBoundingClientRect()\n    mouse.current.set(\n      ((event.clientX - rect.left) / rect.width) * 2 - 1,\n      -((event.clientY - rect.top) / rect.height) * 2 + 1\n    )\n    \n    raycaster.current.setFromCamera(mouse.current, camera)\n    \n    // Find intersection with drag plane\n    const intersectPoint = new Vector3()\n    const hasIntersection = raycaster.current.ray.intersectPlane(dragPlane.current, intersectPoint)\n    \n    if (hasIntersection && intersectPoint) {\n      const newPosition = intersectPoint.add(dragOffset.current)\n      \n      // Surface detection for smart snapping\n      const surfaceRay = new Raycaster(\n        new Vector3(newPosition.x, newPosition.y + 1, newPosition.z),\n        new Vector3(0, -1, 0)\n      )\n      \n      const surfaceIntersects = surfaceRay.intersectObjects(surfaces, true)\n      let targetY = 0 // Default floor level\n      \n      // Find closest valid surface\n      for (const intersect of surfaceIntersects) {\n        if (intersect.object !== selectedObject.object) {\n          targetY = intersect.point.y\n          break\n        }\n      }\n      \n      // Update object position with surface snapping\n      const finalPosition = new Vector3(newPosition.x, targetY, newPosition.z)\n      \n      updateObject(selectedObject.id, {\n        position: finalPosition\n      })\n      \n      requestRender()\n    }\n  }, 8) // 120fps for smooth dragging\n  \n  // End dragging\n  const endDrag = useCallback(() => {\n    if (!isDragging.current) return\n    \n    isDragging.current = false\n    gl.domElement.style.cursor = 'default'\n    \n    // Snap to final position\n    if (selectedObject) {\n      requestRender()\n    }\n  }, [gl, selectedObject, requestRender])\n  \n  // Setup event listeners\n  const setupDragListeners = useCallback(() => {\n    const canvas = gl.domElement\n    \n    const handlePointerDown = (e: PointerEvent) => {\n      if (e.button === 0 && selectedObject) { // Left mouse button\n        startDrag(e)\n        e.preventDefault()\n      }\n    }\n    \n    const handlePointerMove = (e: PointerEvent) => {\n      if (isDragging.current) {\n        handleDrag(e)\n        e.preventDefault()\n      }\n    }\n    \n    const handlePointerUp = (e: PointerEvent) => {\n      if (e.button === 0) { // Left mouse button\n        endDrag()\n        e.preventDefault()\n      }\n    }\n    \n    canvas.addEventListener('pointerdown', handlePointerDown)\n    document.addEventListener('pointermove', handlePointerMove)\n    document.addEventListener('pointerup', handlePointerUp)\n    \n    return () => {\n      canvas.removeEventListener('pointerdown', handlePointerDown)\n      document.removeEventListener('pointermove', handlePointerMove)\n      document.removeEventListener('pointerup', handlePointerUp)\n    }\n  }, [startDrag, handleDrag, endDrag, gl, selectedObject])\n  \n  return {\n    isDragging: isDragging.current,\n    setupDragListeners,\n    startDrag,\n    endDrag\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;AAEO,SAAS;;IACd,MAAM,EAAE,MAAM,EAAE,EAAE,EAAE,GAAG,IAAA,8NAAQ;IAC/B,MAAM,aAAa,IAAA,uKAAM,EAAC;IAC1B,MAAM,YAAY,IAAA,uKAAM,EAAC,IAAI,2JAAK,CAAC,IAAI,6JAAO,CAAC,GAAG,GAAG,IAAI;IACzD,MAAM,aAAa,IAAA,uKAAM,EAAC,IAAI,6JAAO;IACrC,MAAM,YAAY,IAAA,uKAAM,EAAC,IAAI,+JAAS;IACtC,MAAM,QAAQ,IAAA,uKAAM,EAAC,IAAI,6JAAO;IAChC,MAAM,gBAAgB,IAAA,uKAAM,EAAC,IAAI,6JAAO;IAExC,MAAM,iBAAiB,IAAA,wIAAQ;mDAAC,CAAA,QAAS,MAAM,cAAc;;IAC7D,MAAM,eAAe,IAAA,wIAAQ;iDAAC,CAAA,QAAS,MAAM,YAAY;;IACzD,MAAM,WAAW,IAAA,wIAAQ;6CAAC,CAAA,QAAS,MAAM,QAAQ;;IACjD,MAAM,gBAAgB,IAAA,wIAAQ;kDAAC,CAAA,QAAS,MAAM,aAAa;;IAE3D,iBAAiB;IACjB,MAAM,YAAY,IAAA,4KAAW;iDAAC,CAAC;YAC7B,IAAI,CAAC,gBAAgB;YAErB,WAAW,OAAO,GAAG;YACrB,cAAc,OAAO,CAAC,IAAI,CAAC,eAAe,QAAQ;YAElD,MAAM,OAAO,GAAG,UAAU,CAAC,qBAAqB;YAChD,MAAM,OAAO,CAAC,GAAG,CACf,AAAC,CAAC,MAAM,OAAO,GAAG,KAAK,IAAI,IAAI,KAAK,KAAK,GAAI,IAAI,GACjD,CAAC,CAAC,CAAC,MAAM,OAAO,GAAG,KAAK,GAAG,IAAI,KAAK,MAAM,IAAI,IAAI;YAGpD,UAAU,OAAO,CAAC,aAAa,CAAC,MAAM,OAAO,EAAE;YAE/C,gDAAgD;YAChD,UAAU,OAAO,CAAC,6BAA6B,CAC7C,IAAI,6JAAO,CAAC,GAAG,GAAG,IAClB,eAAe,QAAQ;YAGzB,0CAA0C;YAC1C,MAAM,iBAAiB,IAAI,6JAAO;YAClC,UAAU,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,UAAU,OAAO,EAAE;YAExD,IAAI,gBAAgB;gBAClB,WAAW,OAAO,CAAC,IAAI,CAAC,eAAe,QAAQ,EAAE,GAAG,CAAC;YACvD;YAEA,GAAG,UAAU,CAAC,KAAK,CAAC,MAAM,GAAG;YAC7B;QACF;gDAAG;QAAC;QAAgB;QAAQ;QAAI;KAAc;IAE9C,gDAAgD;IAChD,MAAM,aAAa,IAAA,yJAAoB;2DAAC,CAAC;YACvC,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC,gBAAgB;YAE5C,MAAM,OAAO,GAAG,UAAU,CAAC,qBAAqB;YAChD,MAAM,OAAO,CAAC,GAAG,CACf,AAAC,CAAC,MAAM,OAAO,GAAG,KAAK,IAAI,IAAI,KAAK,KAAK,GAAI,IAAI,GACjD,CAAC,CAAC,CAAC,MAAM,OAAO,GAAG,KAAK,GAAG,IAAI,KAAK,MAAM,IAAI,IAAI;YAGpD,UAAU,OAAO,CAAC,aAAa,CAAC,MAAM,OAAO,EAAE;YAE/C,oCAAoC;YACpC,MAAM,iBAAiB,IAAI,6JAAO;YAClC,MAAM,kBAAkB,UAAU,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,UAAU,OAAO,EAAE;YAEhF,IAAI,mBAAmB,gBAAgB;gBACrC,MAAM,cAAc,eAAe,GAAG,CAAC,WAAW,OAAO;gBAEzD,uCAAuC;gBACvC,MAAM,aAAa,IAAI,+JAAS,CAC9B,IAAI,6JAAO,CAAC,YAAY,CAAC,EAAE,YAAY,CAAC,GAAG,GAAG,YAAY,CAAC,GAC3D,IAAI,6JAAO,CAAC,GAAG,CAAC,GAAG;gBAGrB,MAAM,oBAAoB,WAAW,gBAAgB,CAAC,UAAU;gBAChE,IAAI,UAAU,EAAE,sBAAsB;;gBAEtC,6BAA6B;gBAC7B,KAAK,MAAM,aAAa,kBAAmB;oBACzC,IAAI,UAAU,MAAM,KAAK,eAAe,MAAM,EAAE;wBAC9C,UAAU,UAAU,KAAK,CAAC,CAAC;wBAC3B;oBACF;gBACF;gBAEA,+CAA+C;gBAC/C,MAAM,gBAAgB,IAAI,6JAAO,CAAC,YAAY,CAAC,EAAE,SAAS,YAAY,CAAC;gBAEvE,aAAa,eAAe,EAAE,EAAE;oBAC9B,UAAU;gBACZ;gBAEA;YACF;QACF;0DAAG,GAAG,6BAA6B;;IAEnC,eAAe;IACf,MAAM,UAAU,IAAA,4KAAW;+CAAC;YAC1B,IAAI,CAAC,WAAW,OAAO,EAAE;YAEzB,WAAW,OAAO,GAAG;YACrB,GAAG,UAAU,CAAC,KAAK,CAAC,MAAM,GAAG;YAE7B,yBAAyB;YACzB,IAAI,gBAAgB;gBAClB;YACF;QACF;8CAAG;QAAC;QAAI;QAAgB;KAAc;IAEtC,wBAAwB;IACxB,MAAM,qBAAqB,IAAA,4KAAW;0DAAC;YACrC,MAAM,SAAS,GAAG,UAAU;YAE5B,MAAM;oFAAoB,CAAC;oBACzB,IAAI,EAAE,MAAM,KAAK,KAAK,gBAAgB;wBACpC,UAAU;wBACV,EAAE,cAAc;oBAClB;gBACF;;YAEA,MAAM;oFAAoB,CAAC;oBACzB,IAAI,WAAW,OAAO,EAAE;wBACtB,WAAW;wBACX,EAAE,cAAc;oBAClB;gBACF;;YAEA,MAAM;kFAAkB,CAAC;oBACvB,IAAI,EAAE,MAAM,KAAK,GAAG;wBAClB;wBACA,EAAE,cAAc;oBAClB;gBACF;;YAEA,OAAO,gBAAgB,CAAC,eAAe;YACvC,SAAS,gBAAgB,CAAC,eAAe;YACzC,SAAS,gBAAgB,CAAC,aAAa;YAEvC;kEAAO;oBACL,OAAO,mBAAmB,CAAC,eAAe;oBAC1C,SAAS,mBAAmB,CAAC,eAAe;oBAC5C,SAAS,mBAAmB,CAAC,aAAa;gBAC5C;;QACF;yDAAG;QAAC;QAAW;QAAY;QAAS;QAAI;KAAe;IAEvD,OAAO;QACL,YAAY,WAAW,OAAO;QAC9B;QACA;QACA;IACF;AACF;GArJgB;;QACS,8NAAQ;QAQR,wIAAQ;QACV,wIAAQ;QACZ,wIAAQ;QACH,wIAAQ;QAoCX,yJAAoB","debugId":null}},
    {"offset": {"line": 1165, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Linh/Desktop/DeskDesigner/desk-designer-next/src/components/Canvas3D.tsx"],"sourcesContent":["'use client'\n\nimport { Canvas, useThree } from '@react-three/fiber'\nimport { Suspense, useEffect } from 'react'\nimport { PCFSoftShadowMap, SRGBColorSpace, ACESFilmicToneMapping } from 'three'\nimport { Stats, AdaptiveDpr, AdaptiveEvents } from '@react-three/drei'\nimport { Room } from './Scene/Room'\nimport { Lights, SHADOW_CONFIG } from './Scene/Lights'\nimport { Camera } from './Scene/Camera'\nimport { ObjectLoader, preloadModels } from './Objects/ObjectLoader'\nimport { useStore } from '@/stores/useStore'\nimport { useObjectSelection } from '@/hooks/useObjectSelection'\nimport { useDragAndDrop } from '@/hooks/useDragAndDrop'\nimport { usePerformanceMonitor, useRenderOnDemand } from '@/hooks/usePerformance'\n\n// Scene content component\nfunction SceneContent() {\n  const objects = useStore(state => state.objects)\n  const fps = usePerformanceMonitor()\n  const { invalidate } = useThree()\n  \n  // Re-enable essential functionality for proper rendering\n  const { handleSelect, handleHover } = useObjectSelection()\n  const { setupDragListeners } = useDragAndDrop()\n  \n  // Setup interaction listeners\n  useEffect(() => {\n    const cleanup = setupDragListeners()\n    return cleanup\n  }, [setupDragListeners])\n  \n  // Initial render\n  useEffect(() => {\n    invalidate()\n  }, [invalidate])\n  \n  return (\n    <>\n      {/* Core Scene */}\n      <Camera />\n      <Lights timeOfDay=\"day\" />\n      <Room />\n      \n      {/* Dynamic Objects */}\n      {objects.map((obj) => (\n        <primitive \n          key={obj.id} \n          object={obj.object} \n          position={obj.position}\n          scale={obj.scale}\n          rotation={[0, obj.rotation, 0]}\n        />\n      ))}\n      \n      {/* Performance Stats (Development) */}\n      {process.env.NODE_ENV === 'development' && (\n        <Stats showPanel={0} className=\"stats\" />\n      )}\n    </>\n  )\n}\n\n// Loading fallback\nfunction CanvasLoader() {\n  return (\n    <div className=\"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-[#f5e6d3] to-[#e8d5c4]\">\n      <div className=\"text-[#8b6f47] font-medium\">Loading 3D Scene...</div>\n    </div>\n  )\n}\n\n// Main Canvas component\nexport function Canvas3D() {\n  const renderRequested = useStore(state => state.renderRequested)\n  \n  // Preload models on component mount\n  useEffect(() => {\n    preloadModels()\n  }, [])\n  \n  return (\n    <div className=\"absolute inset-0\">\n      <Canvas\n        // Performance optimizations\n        dpr={1} // Fixed pixel ratio for consistent performance\n        frameloop=\"demand\" // Always use demand mode for better performance\n        flat // Disable linear tone mapping for better performance\n        legacy={false} // Use modern WebGL features\n        \n        // Canvas configuration\n        camera={false} // We'll use our custom camera\n        shadows={{\n          enabled: true,\n          type: PCFSoftShadowMap,\n          autoUpdate: false\n        }}\n        \n        // WebGL settings\n        gl={{\n          powerPreference: 'high-performance',\n          antialias: true,\n          alpha: false,\n          stencil: false,\n          depth: true,\n          logarithmicDepthBuffer: false,\n          outputColorSpace: SRGBColorSpace,\n          toneMapping: ACESFilmicToneMapping,\n          toneMappingExposure: 0.88,\n          shadowMap: {\n            enabled: true,\n            type: PCFSoftShadowMap,\n            autoUpdate: false\n          }\n        }}\n        \n        // Container styling\n        className=\"outline-none\"\n        style={{ \n          touchAction: 'none',\n          WebkitTouchCallout: 'none',\n          WebkitUserSelect: 'none',\n          userSelect: 'none'\n        }}\n      >\n        {/* Performance Helpers */}\n        <AdaptiveEvents />\n        \n        {/* Scene Content with Suspense */}\n        <Suspense fallback={null}>\n          <SceneContent />\n        </Suspense>\n        \n        {/* Fog for depth */}\n        <fog attach=\"fog\" args={[0xe8d5c4, 25, 50]} />\n      </Canvas>\n      \n      {/* Canvas Loader Overlay */}\n      <Suspense fallback={<CanvasLoader />}>\n        <div /> {/* Empty div to trigger Suspense */}\n      </Suspense>\n    </div>\n  )\n}"],"names":[],"mappings":";;;;AAuDO;;AArDP;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAbA;;;;;;;;;;;;;AAeA,0BAA0B;AAC1B,SAAS;;IACP,MAAM,UAAU,IAAA,wIAAQ;0CAAC,CAAA,QAAS,MAAM,OAAO;;IAC/C,MAAM,MAAM,IAAA,0JAAqB;IACjC,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,8NAAQ;IAE/B,yDAAyD;IACzD,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,GAAG,IAAA,2JAAkB;IACxD,MAAM,EAAE,kBAAkB,EAAE,GAAG,IAAA,mJAAc;IAE7C,8BAA8B;IAC9B,IAAA,0KAAS;kCAAC;YACR,MAAM,UAAU;YAChB,OAAO;QACT;iCAAG;QAAC;KAAmB;IAEvB,iBAAiB;IACjB,IAAA,0KAAS;kCAAC;YACR;QACF;iCAAG;QAAC;KAAW;IAEf,qBACE;;0BAEE,6LAAC,kJAAM;;;;;0BACP,6LAAC,kJAAM;gBAAC,WAAU;;;;;;0BAClB,6LAAC,8IAAI;;;;;YAGJ,QAAQ,GAAG,CAAC,CAAC,oBACZ,6LAAC;oBAEC,QAAQ,IAAI,MAAM;oBAClB,UAAU,IAAI,QAAQ;oBACtB,OAAO,IAAI,KAAK;oBAChB,UAAU;wBAAC;wBAAG,IAAI,QAAQ;wBAAE;qBAAE;mBAJzB,IAAI,EAAE;;;;;YASd,oDAAyB,+BACxB,6LAAC,qKAAK;gBAAC,WAAW;gBAAG,WAAU;;;;;;;;AAIvC;GA5CS;;QACS,wIAAQ;QACZ,0JAAqB;QACV,8NAAQ;QAGO,2JAAkB;QACzB,mJAAc;;;KAPtC;AA8CT,mBAAmB;AACnB,SAAS;IACP,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;sBAA6B;;;;;;;;;;;AAGlD;MANS;AASF,SAAS;;IACd,MAAM,kBAAkB,IAAA,wIAAQ;8CAAC,CAAA,QAAS,MAAM,eAAe;;IAE/D,oCAAoC;IACpC,IAAA,0KAAS;8BAAC;YACR,IAAA,iKAAa;QACf;6BAAG,EAAE;IAEL,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,gNAAM;gBACL,4BAA4B;gBAC5B,KAAK;gBACL,WAAU;gBACV,IAAI;gBACJ,QAAQ;gBAER,uBAAuB;gBACvB,QAAQ;gBACR,SAAS;oBACP,SAAS;oBACT,MAAM,sKAAgB;oBACtB,YAAY;gBACd;gBAEA,iBAAiB;gBACjB,IAAI;oBACF,iBAAiB;oBACjB,WAAW;oBACX,OAAO;oBACP,SAAS;oBACT,OAAO;oBACP,wBAAwB;oBACxB,kBAAkB,oKAAc;oBAChC,aAAa,2KAAqB;oBAClC,qBAAqB;oBACrB,WAAW;wBACT,SAAS;wBACT,MAAM,sKAAgB;wBACtB,YAAY;oBACd;gBACF;gBAEA,oBAAoB;gBACpB,WAAU;gBACV,OAAO;oBACL,aAAa;oBACb,oBAAoB;oBACpB,kBAAkB;oBAClB,YAAY;gBACd;;kCAGA,6LAAC,uLAAc;;;;;kCAGf,6LAAC,yKAAQ;wBAAC,UAAU;kCAClB,cAAA,6LAAC;;;;;;;;;;kCAIH,6LAAC;wBAAI,QAAO;wBAAM,MAAM;4BAAC;4BAAU;4BAAI;yBAAG;;;;;;;;;;;;0BAI5C,6LAAC,yKAAQ;gBAAC,wBAAU,6LAAC;;;;;;kCACnB,6LAAC;;;;;oBAAM;;;;;;;;;;;;;AAIf;IAtEgB;;QACU,wIAAQ;;;MADlB","debugId":null}}]
}